query {
  sequence(programId: "p-100", observationId: "o-100") {
    executionConfig {
      instrument
      ... on GmosNorthExecutionConfig {
        static {
          stageMode
          detector
          mosPreImaging
          nodAndShuffle {
            posA { p { microarcseconds } }
          }
        }
        acquisition {
          ...gmosNorthSequence
        }
        science {
          ...gmosNorthSequence
        }
        setup {
          ...setupTime
        }
      }
      ... on GmosSouthExecutionConfig {
        static {
          stageMode
          detector
          mosPreImaging
          nodAndShuffle {
            posA { p { microarcseconds } }
          }
        }
        acquisition {
          ...gmosSouthSequence
        }
        science {
          ...gmosSouthSequence
        }
        setup {
          ...setupTime
        }        
      }
    }
  }
}

fragment setupTime on SetupTime {
	full { microseconds }
	reacquisition { microseconds }
}

fragment sequenceDigest on SequenceDigest {
  observeClass
  plannedTime {
    charges {
      chargeClass
      time { microseconds }
    }
  }
  offsets {
    p { microarcseconds }
    q { microarcseconds }
  }
}

fragment stepConfigFields on StepConfig { 
  stepType  
  ... on Gcal {
    continuum
    arcs
    filter
    diffuser
    shutter
  }
  ... on Science {
    offset {
      p { microarcseconds }
      q { microarcseconds }
    }
    guiding
  }
  ... on SmartGcal {
    smartGcalType
  }
}

fragment stepEstimateFields on StepEstimate {
  configChange { 
    all {
      name
      description
      estimate { microseconds }
    }
    index
  }
  detector {
    all {
      name
      description
      dataset {
        exposure { microseconds }
        readout { microseconds }
        write { microseconds }
      }
      count
    }
    index
  }
}

fragment gmosNorthAtom on GmosNorthAtom {
  id
  description
  steps {
    id
    instrumentConfig {
      exposure { microseconds }
      readout {
        xBin
        yBin
        ampCount
        ampGain
        ampReadMode
      }
      dtax
      roi
      gratingConfig {
        grating
        order
        wavelength { picometers }
      }
      filter
      fpu {
        builtin
      }
    }
    stepConfig {
      ...stepConfigFields
    }
    estimate {
      ...stepEstimateFields
    }
    observeClass
    breakpoint
  }
}

fragment gmosNorthSequence on GmosNorthExecutionSequence {
  digest {
    ...sequenceDigest
  }
  nextAtom {
    ...gmosNorthAtom
  }
  possibleFuture {
    ...gmosNorthAtom
  }
  hasMore
  atomCount
}

fragment gmosSouthAtom on GmosNorthAtom {
  id
  description
  steps {
    id
    instrumentConfig {
      exposure { microseconds }
      readout {
        xBin
        yBin
        ampCount
        ampGain
        ampReadMode
      }
      dtax
      roi
      gratingConfig {
        grating
        order
        wavelength { picometers }
      }
      filter
      fpu {
        builtin
      }
    }
    stepConfig {
      ...stepConfigFields
    }
    estimate {
      ...stepEstimateFields
    }
    observeClass
    breakpoint
  }
}

fragment gmosSouthSequence on GmosNorthExecutionSequence {
  digest {
    ...sequenceDigest
  }
  nextAtom {
    ...gmosSouthAtom
  }
  possibleFuture {
    ...gmosSouthAtom
  }
  hasMore
  atomCount
}