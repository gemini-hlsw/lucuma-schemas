query {
  observation(observationId:"o-2") {
    	id
      execution {
        executionConfig {
          instrument
          ...on GmosNorthExecutionConfig {
            visits {
              id
              created
              startTime
              endTime
              duration { microseconds }
              staticN:staticConfig {
                stageMode
                detector
                mosPreImaging
                nodAndShuffle {
                  ...nodAndShuffleFields
                }                
              }
              stepsN:steps {
								...gmosNorthStepRecordFields
              }
              sequenceEvents {
                id
                received
                payload {
                  command
                }
              }              
            }
          }
          ...on GmosSouthExecutionConfig {
            visits {
              id
              created
              startTime
              endTime
              duration { microseconds }             
              staticS:staticConfig {
                stageMode
                detector
                mosPreImaging
                nodAndShuffle {
                  ...nodAndShuffleFields
                }
              }
              stepsS:steps {
                ...gmosSouthStepRecordFields
              }
              sequenceEvents {
                id
                received
                payload {
                  command
                }
              }
            }
          }          
        }
      }
    }
  }
  
fragment nodAndShuffleFields on GmosNodAndShuffle {
  posA {
    p { microarcseconds }
    q { microarcseconds }
  }
  posB {
    p { microarcseconds }
    q { microarcseconds }
  }
  eOffset
  shuffleOffset
  shuffleCycles
}

fragment gmosNorthStepRecordFields on GmosNorthStepRecord {
  id
  created
  startTime
  endTime
  duration { microseconds }
  instrumentConfig {
    exposure { microseconds }
    readout {
      xBin
      yBin
      ampCount
      ampGain
      ampReadMode
    }
    dtax
    roi
    gratingConfig {
      grating
      order
      wavelength { picometers }
    }
    filter
    fpu {
      customMask {
        filename
        slitWidth
      }
      builtin
    }
  }
  stepConfig {
    stepType
    ...on Gcal {
      continuum
      arcs
      filter
      diffuser
      shutter
    }
    ...on Science {
      offset {
        p { microarcseconds }
        q { microarcseconds }
      }
      guiding
    }
  }
  stepEvents {
    id
    received
    payload {
      sequenceType
      stepStage
    }
  }
  stepQaState
  datasetEvents {
    id
    received
    datasetId {
      index
    }
  }
  datasets {
    id {
      index
    }
    filename
    qaState
  }
}


fragment gmosSouthStepRecordFields on GmosSouthStepRecord {
	id
  created
  startTime
  endTime
  duration { microseconds }
  instrumentConfig {
    exposure { microseconds }
    readout {
      xBin
      yBin
      ampCount
      ampGain
      ampReadMode
    }
    dtax
    roi
    gratingConfig {
      grating
      order
      wavelength { picometers }
    }
    filter
    fpu {
      customMask {
        filename
        slitWidth
      }
      builtin
    }
  }
  stepConfig {
    stepType
    ...on Gcal {
      continuum
      arcs
      filter
      diffuser
      shutter
    }
    ...on Science {
      offset {
        p { microarcseconds }
        q { microarcseconds }
      }

    }
  }
  stepEvents {
    id
    received
    payload {
      sequenceType
      stepStage
    }
  }
  stepQaState
  datasetEvents {
    id
    received
    datasetId {
      index
    }
  }
  datasets {
    id {
      index
    }
    filename
    qaState
  }
}